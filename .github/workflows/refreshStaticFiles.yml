name: Refresh static files

on:
    schedule:
        # Each day at 13:00 Brussels (11:00 UTC)
        - cron: '0 11 * * *'
    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:

jobs:
    updater:
        runs-on: ubuntu-latest
        permissions:
          contents: write
          pull-requests: write
        steps:
            - name: ğŸ›ï¸ Checkout
              uses: actions/checkout@v6
            - name: Setup Node.js âœ¨
              uses: actions/setup-node@v6
              with:
                node-version: "lts/*"
                cache: 'npm'
            - name: ğŸ’» Install npm packages
              run: npm install better-sqlite3 --no-save
            - name: ğŸ¤– Do the thing
              run: npm run generate-api-json-files
            - name: ğŸ’… Create Pull Request
              uses: peter-evans/create-pull-request@v7
              with:
                title: "[auto-updater] Updated static files"
                token: ${{ secrets.PAT }}
                labels: |
                  automerge
                body: |
                  This is an automated update of static files based on the latest data in the database.
                  
                  Updated files:
                  - backlog.json
                  - games.json
                  - series.json
                  - tests.json
                  - platforms.json
                  - genres.json
                  - planning.json
                  - stats.json  
                  - past-planning.json  
                  - dlcs.json  
                  - identifiers.json
                  - rss.xml

                  @coderabbitai ignore
                draft: false
